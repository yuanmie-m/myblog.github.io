I"<blockquote>
  <p>nginx第1篇. ”</p>
</blockquote>

<p>nginx，搞懂反向代理和负载均衡！</p>

<h1 id="反向代理">反向代理</h1>

<p><code class="language-plaintext highlighter-rouge">反向代理怎么做？具体如何实现？</code></p>

<h2 id="代理的分类">代理的分类</h2>

<p>有反向代理就有正向代理。</p>

<h3 id="概念">概念</h3>
<p>正向代理：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>正向代理，架设在客户机与目标主机之间，只用于代理内部网络对Internet的连接请求，客户机必须指定代理服务器,并将本来要直接发送到Web服务器上的http请求发送到代理服务器中。
</code></pre></div></div>

<p>反向代理：</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>反向代理服务器架设在服务器端，通过缓冲经常被请求的页面来缓解服务器的工作量，将客户机请求转发给内部网络上的目标服务器；并将从服务器上得到的结果返回给Internet上请求连接的客户端（理解+背），此时代理服务器与目标主机一起对外表现为一个服务器。 ### 区别 反向代理和正向代理的区别就是：

正向代理代理客户端，反向代理代理服务器。
</code></pre></div></div>

<h3 id="作用">作用</h3>
<p>正向代理：类似一个跳板机，代理访问外部资源。（在客户机和目标主机之间）</p>

<p>作用：</p>

<p>（1）访问原来无法访问的资源，如google（做VPN）</p>

<p>（2）可以做缓存，加速访问资源</p>

<p>（3）对客户端访问授权，上网进行认证</p>

<p>（4）代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息</p>

<p>反向代理：以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端。（架设在服务器端）</p>

<p>作用：</p>

<p>（1）保证内网的安全，阻止web攻击，大型网站，通常将反向代理作为公网访问地址，Web服务器是内网</p>

<p>（2）负载均衡，通过反向代理服务器来优化网站的负载</p>

<p>（3）通过缓存静态资源，加速Web请求。</p>

<h3 id="透明代理">透明代理</h3>

<p>面试被问到了。</p>

<p>它主要指内网主机需要访问外网主机时，不需要做任何设置，完全意识不到防火墙的存在，而完成内外网的通信。但其基本原理是防火墙代替内部网络主机完成与外网主机通信，然后把结果传回给内网主机，在这个过程中，无论内网主机还是外网主机都意识不到它们其实是在和防火墙通信。而从外网只能看到防火墙，这就隐藏了内网网络，提高了安全性。</p>

<h2 id="nginx反向代理的例子">nginx反向代理的例子</h2>

<h1 id="负载均衡">负载均衡</h1>

<p><code class="language-plaintext highlighter-rouge">负载均衡怎么做？具体怎么实现？</code></p>

<p>一句话：nginx会给你分配服务器压力小的去访问。</p>

<p>如何去实现负载均衡？<a href="http://nginx.org/en/docs/http/load_balancing.html">官网</a>给了几种方法。</p>

<h2 id="轮循默认">轮循（默认）</h2>

<p>Nginx根据请求次数，将每个请求均匀分配到每台服务器</p>

<h2 id="最少连接">最少连接</h2>

<p>将请求分配给连接数最少的服务器。Nginx会统计哪些服务器的连接数最少。</p>

<h2 id="ip-hash">IP Hash</h2>

<p>绑定处理请求的服务器。第一次请求时，根据该客户端的IP算出一个HASH值，将请求分配到集群中的某一台服务器上。后面该客户端的所有请求，都将通过HASH算法，找到之前处理这台客户端请求的服务器，然后将请求交给它来处理。（如果客户已经访问了某个服务器，当用户再次访问时，会将该请求通过哈希算法，自动定位到该服务器。）</p>

<h2 id="指定权重weight">指定权重（weight）</h2>

<p>指定轮询几率，weight和访问比率成正比，用于后端服务器性能不均的情况。</p>
:ET