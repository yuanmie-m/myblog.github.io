I"7<blockquote>
  <p>â€œprometheusç¬¬1ç¯‡. â€</p>
</blockquote>

<p>prometheusæ˜¯ä¸€ä¸ªå¼€æºçš„ç›‘æ§ç³»ç»Ÿå’Œæ—¶åºæ•°æ®åº“ï¼ŒPrometheusä½¿ç”¨Goè¯­è¨€å¼€å‘ã€‚</p>

<h1 id="æ¶æ„å›¾">æ¶æ„å›¾</h1>
<p><img src="https://mlog.club/api/img/proxy?url=https%3A%2F%2Fmmbiz.qpic.cn%2Fmmbiz_png%2FicdBCpcEToI9eliaV8MvxvhicN6V3EGVkpTZwxMNJ1r8aoupeBOzP3l7nYHFiahmibNrMIWibnX2Nk7iaFJjKEodg1TRQ%2F640%3Fwx_fmt%3Dpng" alt="avatar" /></p>

<p><a href="https://mlog.club/article/2966580">å›¾ç‰‡æ¥æº</a></p>

<p>prometheusçš„ç»„æˆï¼šprometheus serverï¼Œjob epoerterï¼ˆprometheus targetsï¼‰ï¼Œservice discoveryï¼Œpushgatewayï¼Œweb UIï¼Œalertmanager</p>

<h2 id="prometheus-server">prometheus server</h2>
<p>prometheus serveråŒ…æ‹¬ï¼šretrievalï¼Œstorageï¼ˆtsdbï¼‰ï¼Œhttp serverã€‚</p>

<p>Prometheus Serverï¼šç”¨äºæŠ“å–å’Œå­˜å‚¨æ—¶é—´åºåˆ—åŒ–æ•°æ®ï¼Œä»job exportersä¸­å»æ‹‰å»æ•°æ®ã€‚</p>

<h2 id="retrieval">retrieval</h2>
<p>Retrievalï¼šæ•°æ®æ”¶é›†ä¸­å¿ƒï¼Œæ”¶é›†è‡ªåŠ¨å‘ç°çš„è§„åˆ™(è‡ªåŠ¨å‘ç°çš„è§„åˆ™)ï¼Œæ”¶é›†ç›‘æ§çš„æŒ‡æ ‡(job exporter)ï¼Œç„¶ååœ¨ä¼ å…¥tsdbä¸­ã€‚</p>

<h2 id="tsdb">TSDB</h2>
<p>TSDBï¼šæ—¶é—´åºåˆ—æ•°æ®åº“ï¼Œå°†æ•°æ®å†™å…¥ï¼šHDD/SSDä¸­</p>

<h2 id="http-server">http server</h2>
<p>http serverï¼šç»™ä¸€ä¸ªæ¥å£ï¼Œç»™alertmanagerå’Œgrafanaæ¥å£</p>

<h2 id="service-discovery">Service discovery</h2>
<p>Service discoveryï¼šæœåŠ¡è‡ªåŠ¨å‘ç°ã€‚</p>

<p>ä¸»è¦æœ‰2ç§çš„æœåŠ¡å‘ç°:</p>

<ul>
  <li>1.æ˜¯ç›´æ¥åŸºäºk8sçš„æºæ•°æ®çš„è‡ªåŠ¨å‘ç°ï¼škubernetes_sd</li>
  <li>2.æ˜¯åŸºäºæ–‡ä»¶è‡ªåŠ¨å‘ç°ï¼ŒæŠŠè‡ªåŠ¨å‘ç°è§„åˆ™å†™å…¥file_sdæ–‡ä»¶ä¸­ã€‚</li>
</ul>

<p>äºŒç§æ–¹å¼çš„åº”ç”¨åœºæ™¯ï¼š</p>

<p>Kubernetes_sdï¼šæœåŠ¡åŸºäºk8sçš„å®¹å™¨ç¼–æ’å®¹å™¨çš„å®¹å™¨äº‘ç›‘æ§çš„è‡ªåŠ¨å‘ç°ã€‚</p>

<p>File_sdï¼šè‡ªåŠ¨å‘ç°åº”ç”¨ä¸åœ¨k8sä¸­çš„è‡ªåŠ¨å‘ç°ï¼Œéœ€è¦åœ¨æ–‡ä»¶ä¸­å†™å…¥è§„åˆ™ã€‚</p>

<h2 id="exporters">exporters</h2>
<p>Job exportersï¼ˆä¹Ÿå«prometheus targetsï¼‰ï¼šè¦ç›‘æ§é‚£äº›ä¸œè¥¿ï¼Œæ˜¯ç”±å®ƒæ¥æ‹‰å–ï¼Œç›¸å½“äºzabbixçš„agentï¼Œä¸»åŠ¨æ‹‰å–æ•°æ®çš„æ’ä»¶ã€‚å¤šç”¨ã€‚</p>

<p>æ•™ç¨‹ä¸­ä½¿ç”¨åˆ°çš„ï¼škube-state-metricï¼Œnode-exporterï¼Œcadvisorï¼Œblackbox-exporter</p>

<p>ä½œç”¨ï¼š</p>

<p>kube-state-metricï¼šæ”¶é›†k8såŸºæœ¬çŠ¶æ€ä¿¡æ¯ï¼Œå¤šå°‘èŠ‚ç‚¹ï¼Œå¤šå°‘podï¼Œpodæ›´æ–°äº†å¤šå°‘ç‰ˆã€‚å…³æ³¨äºè·å–k8så„ç§èµ„æºçš„æœ€æ–°çŠ¶æ€ï¼Œå¦‚deploymentæˆ–è€…daemonsetã€‚èµ„æºå¯¹è±¡åŒ…æ‹¬daemonsetï¼Œdeploymentï¼Œjobï¼Œnamespaceï¼Œnodeï¼Œpvcï¼Œpod_containerï¼Œpodï¼Œreplicasetï¼Œserviceï¼Œstatefulsetã€‚</p>

<p>Node-exporterï¼šæ”¶é›†k8sè¿ç®—èŠ‚ç‚¹ä¸Šçš„åŸºç¡€è®¾æ–½ä¿¡æ¯ï¼Œè¿ç®—èŠ‚ç‚¹è¿˜æœ‰å¤šå°‘å†…å­˜ï¼Œç£ç›˜ä½¿ç”¨é‡ï¼ŒCPUä½¿ç”¨é‡ï¼Œç½‘ç»œIOç­‰ç­‰ï¼ˆéƒ¨ç½²åœ¨æ‰€æœ‰è¿ç®—èŠ‚ç‚¹ä¸Šï¼‰ã€‚
Prometheusæä¾›çš„NodeExporteré¡¹ç›®å¯ä»¥æå–ä¸»æœºèŠ‚ç‚¹çš„å…³é”®åº¦é‡æŒ‡æ ‡ï¼Œé€šè¿‡Kubernetesçš„DeamonSetæ¨¡å¼å¯ä»¥åœ¨å„ä¸»æœºèŠ‚ç‚¹ä¸Šéƒ¨ç½²ä¸€ä¸ªNodeExporterå®ä¾‹ï¼Œå®ç°å¯¹ä¸»æœºæ€§èƒ½æŒ‡æ ‡æ•°æ®çš„ç›‘æ§ã€‚</p>

<p>cadvisorï¼šç›‘æ§å®¹å™¨å†…ç½®ä½¿ç”¨èµ„æºçš„ä¸»è¦å·¥å…·ï¼Œæ”¶é›†å½“å‰èŠ‚ç‚¹ä¸Šè¿è¡Œçš„æ‰€æœ‰å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œæ¯å®¹å™¨åˆ°åº•è€—è´¹äº†å¤šå°‘èµ„æºï¼ˆå†…å­˜ï¼ŒCPUï¼‰</p>

<p>Blackbox-exporterï¼šåˆ¤æ–­å®¹å™¨æ˜¯å¦å­˜æ´»ç­‰ã€‚</p>

<h2 id="pushgateway">Pushgateway</h2>
<p>Pushgatewayï¼šè¢«åŠ¨æ‹‰å–æ•°æ®çš„æ’ä»¶ã€‚å°‘ç”¨ã€‚</p>

<h2 id="altermanager">Altermanager</h2>
<p>Altermanagerï¼šå‘Šè­¦å‘é€æ¨¡å—</p>

<h2 id="prometheus-web-ui">Prometheus web UI</h2>
<p>Prometheus web UIï¼šç•Œé¢åŒ–ï¼Œä¹ŸåŒ…å«ç»“åˆGrafanaè¿›è¡Œæ•°æ®å±•ç¤ºæˆ–å‘Šè­¦å‘é€</p>

<h2 id="å…¶ä»–ç»„ä»¶ä»‹ç»">å…¶ä»–ç»„ä»¶ä»‹ç»</h2>
<p>ä½¿ç”¨metric-serveræ”¶é›†æ•°æ®ç»™k8sé›†ç¾¤å†…ä½¿ç”¨ï¼Œå¦‚kubectl,hpa,schedulerç­‰</p>

<p>ä½¿ç”¨prometheus-operatoréƒ¨ç½²prometheusï¼Œå­˜å‚¨ç›‘æ§æ•°æ®</p>

<p>ä½¿ç”¨kube-state-metricsæ”¶é›†k8sé›†ç¾¤å†…èµ„æºå¯¹è±¡æ•°æ®</p>

<p>ä½¿ç”¨node_exporteræ”¶é›†é›†ç¾¤ä¸­å„èŠ‚ç‚¹çš„æ•°æ®</p>

<p>ä½¿ç”¨prometheusæ”¶é›†apiserverï¼Œschedulerï¼Œcontroller-managerï¼Œkubeletç»„ä»¶æ•°æ®</p>
:ET